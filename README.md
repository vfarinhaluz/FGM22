# Replication package for: Risk classification numerical simulations

Authors:
Vitor Farinha Luz,
Piero Gottardi,
Humberto Moreira.


## Summary
This repository contains the code for numerical simulations for the paper "Risk Classification in Insurance Markets with Risk and Preference Heterogeneity",
by Vitor Farinha Luz, Piero Gottardi and Humberto Moreira.

Contact: [vitor.farinhaluz@ubc.ca](mailto:vitor.farinhaluz@ubc.ca)

Matlab research assistance by Pedro Melgar√©.

This code can also be accessed at:
[https://github.com/vfarinhaluz/FGM22](https://github.com/vfarinhaluz/FGM22)

---

## Data Availability Statements
This paper does not involve analysis of external data (i.e., no data are used or the only data are generated by the authors via simulation in their code).
The code generating Figures 3, 4 and 5 is in this repository.

---

## Computational requirements

The replication package was run successfully on a 2021 MacBook Pro, mac OS Ventura with
MatlabR2022b.

### Runtime requirements

Figure 3: 50 seconds

Figure 4: 11 hours (5.5 hours for each subplot)

Figure 5: 10 hours (5 hours for each subplot)

## Description of reproduction steps ##

#### Code ####

To replicate Figure 3, run BaselineSignalAnalysis.m

To replicate Figure 4, follow these steps.

- Figure 4.a: run BinMon_SignalAnalysisGridRhoDelta.m

- Figure 4.b: run BinNonMon_SignalAnalysisGridRhoDelta.m

To replicate Figure 5, follow these steps.

- Figure 5.a: run DoubleMon_SignalAnalysisGridRhoDelta.m

- Figure 5.b: run DoubleNonMon_SignalAnalysisGridRhoDelta.m

#### Output ####

Figure 3 is composed of the following files generated by the code BaselineSignalAnalysis.m

- Figure 3.a (left side): plotPricesPerUnit.pdf

- Figure 3.b (right side): EquivalentVariation.pdf

- The referred m-file generates additional useful plots.

Figure 4 is composed of two different parts, called 4.a and 4.b

- Figure 4.a consists of the file Bin_Mon_HeatmapWelfare.pdf, generated by BinMon_SignalAnalysisGridRhoDelta.m

- Figure 4.a consists of the file Bin_Non_Mon_HeatmapWelfare.pdf, generated by BinNonMon_SignalAnalysisGridRhoDelta.m

- The referred m-files generate additional useful plots.

Figure 5 is composed of two different parts, called 5.a and 5.b

- Figure 5.a consists of the file Double_Mon_HeatmapWelfare.pdf, generated by DoubleMon_SignalAnalysisGridRhoDelta.m

- Figure 5.b consists of the file Double_Non_Mon_HeatmapWelfare.pdf, generated by DoubleNonMon_SignalAnalysisGridRhoDelta.m

- The referred m-files generate additional useful plots.

---

## Algorithm description:

An equilibrium in the model is constituted of a price function **p()** and an allocation which maps from the set of types to coverage levels (the paper often uses the inverse mapping, which is a type assignment function).
A type contains both risk (mu) and risk aversion (rho). The algorithm uses a finite grid as the set of possible types.

The algorithm starts from a initial guessed price function and iterates a properly defined operator until convergence is achieved, which represents that an approximate equilibrium has been found.

More precisely, for a given price function p_t, the algorithm calculates the optimal coverage level for each type and defines a new price function  p' as follows:

1. For each contract traded under p_t, the new price p' is updated towards  the average risk of agents purchasing it.
2. The price for each non-traded contract x' is also updated,  but on the basis of the riskiness of the type most willing to pay for it.

The new price p_(t+1) is given by

p_(t+1) = p_t + alpha (p' - p_t),

for some parameter alpha in (0,1) (this parameter is chosen to make sure prices don't fluctuate too much in each step but still converge).

The simulation results are reported in Section 5.5 of the main paper, and Section 1 of the online appendix.

---
## Files and folders in repository

### BaselineEquilibrium.m:
This code computes an approximate competitive equilibrium for the two-dimensional
model discussed in the main paper, allowing for any finite number of contracts and
possible type realizations in each dimension.

### BaselineSignalAnalysis.m:
This code numerically simulates the effect of signal disclosure
for the two-dimensional model discussed in the main paper, allowing for any
finite number of contracts and possible type realizations in each dimension.


### BinMon_SignalAnalysisGridRhoDelta.m:

This code creates a grid varying the following parameters of the model:
- delta: the variation in risk aversion
- rho_0 : the mid-point of the risk aversion range

For each pair of delta and rho_0, the code simulates the effect of signal
disclosure and stores all the simulated data into a large Signal Simulation
array object.

This code generates heatmaps to display variables of interest,
such as: the error term in the iteration algorithm, the mass of
consumers with interim improvement, and the aggregate welfare effect of
the signal disclosure.

The m-file BinMon_SignalAnalysisGridRhoDelta.m  considers a monotonic signal with a binary risk aversion distribution.

The following files are similar but consider other type distributions:

- BinNonMon_SignalAnalysisGridRhoDelta.m considers  a non-monotonic signal with a binary risk aversion distribution.


- DoubleMon_SignalAnalysisGridRhoDelta.m considers  a monotonic signal with a risk aversion distribution allowing for 30 possible values.


- DoubleNonMon_SignalAnalysisGridRhoDelta.m considers  a monotonic signal with a risk aversion distribution allowing for 30 possible values.

### SignalAnalysisGridRhoRisk.m:

This code creates a grid varying the following:
- delta: the variation in risk aversion
- (mu_H - mu_L) : the variation in risk levels

For each pair of deltaRisk and delta, the code simulates the effect of signal
disclosure and stores all the simulated data into a large Signal Simulation
array object.

This code also generates heatmaps to display variables of interest.

### \src\:

Folder containing the following:

1. HyperParameters.m:
defines HyperParameters class, which collects parameters for the iteration algorithm

2. pdfEinavFlex.m: implements the pdf function for a lognormal distribution with covariance parameters set to Einav et al (2013) paper's values, allowing the user to input the first moment of the distribution.

3. Model.m:
	1.  defines Model class, which collects parameters for the model to be solved
	2.  implements several functions to compute consumer demand, average costs, consumer's utility levels, and others

4. Solver.m:
defines Solver class, which collects a Model and HyperParameters. Also in this file is the iteration algorithm used for finding equilibria.

5. SimulationResult.m:
	1. defines SimulationResult class, which collects equilibrium objects (prices, utilities) and the error (ie, the maximum |price-AC| over all contracts) across iterations, as well as model parameters.
	2. implements functions to plot equilibrium objects, such as prices, demand, and type assignment

6. SignalSimulation.m:
This file defines the class SignalSimulation, solves a binary signal disclosure exercise, compute welfare effects, plots changes in equilibrium objects such as prices and utility levels.
